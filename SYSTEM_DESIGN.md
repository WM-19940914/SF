# 멜레아 B2B 유통 웹앱 시스템 설계

> 삼성 에어컨/가전 B2B 유통 업무를 카톡+엑셀에서 웹앱으로 전환하는 프로젝트

---

## 1. 현재 업무 흐름 (AS-IS)

```
① 매월 삼성에서 출고가 엑셀 수신
        ↓
② 엑셀로 수동 계산: 출고가 × DC율 + 4가지 장려금 반영 → 업체별 판매가 산출
        ↓
③ 업체별 단가표를 카톡으로 엑셀/이미지 전송 (10~20개 업체 각각)
        ↓
④ 업체가 카톡 단톡방으로 발주 요청 ("X제품 X대 X일에 어디로 보내주세요")
        ↓
⑤ 우리가 삼성 온라인창고(DPS)에서 수동으로 출고 처리
        ↓
⑥ 엑셀로 발주/출고/매출/재고 기록 관리
```

**문제점:**
- 카톡 단톡방 10개+ → 발주 놓치거나 헷갈림
- 단가표 매월 10~20개 업체에 각각 카톡 전송 → 반복 노동
- 단가 산출을 엑셀 수동 계산 → 실수 가능성
- 발주/매출/재고를 엑셀 3개 파일(30개+ 시트)로 관리 → 비효율

---

## 2. 목표 시스템 (TO-BE)

```
① 삼성 출고가 엑셀 업로드 → 시스템이 자동 반영
        ↓
② 웹앱에서 장려금% 입력 → 업체별 판매가 자동 계산 (수동 수정도 가능)
        ↓
③ "공시" 버튼 → 각 업체가 로그인하면 본인 전용 단가표 즉시 확인
        ↓
④ 업체가 웹앱에서 직접 발주 (제품 선택 → 수량 → 배송지 → 희망일)
        ↓
⑤ 관리자가 발주 목록 확인 → DPS에서 출고 처리 → 웹앱에서 상태 변경
        ↓
⑥ 발주/출고/매출/재고 자동 기록 → 대시보드에서 실시간 조회
```

---

## 3. 사용자 구분

| 구분 | 누가 | 할 수 있는 것 |
|------|------|-------------|
| **관리자** (멜레아) | 우리 직원 | 모든 기능 (단가 산출, 발주 관리, 재고, 매출, 설정) |
| **업체** (거래처) | 10~20개 업체 담당자 | 본인 전용 단가표 조회, 발주 신청, 본인 발주내역 확인, 재고 조회 |

**접속 환경:** 업체는 PC에서 접속

---

## 4. 핵심 기능 상세

### 4-1. 단가 관리 (관리자 전용)

#### 단가 산출 로직

```
삼성 출고가 (매월 변동)
    ↓
삼성 DC율 적용 → 기본 매입가
    ↓
4가지 장려금 반영:
  ├─ 셀인 장려금 %  (매월, 매입량 기준)
  ├─ 셀아웃 장려금 % (매월, 판매량 기준)
  ├─ 분기 장려금 %   (분기별, 판매량 기준)
  └─ 년 장려금 %     (연간, 판매량 기준)
    ↓
우리 마진 % 조정
    ↓
업체별 최종 판매가 (업체마다 장려금 반영 비율이 다름!)
```

**핵심 포인트:**
- 많이 사가는 업체 → 장려금 반영 비율 높게 (100%) → 더 싸게
- 적게 사가는 업체 → 장려금 반영 비율 낮게 (50~70%) → 덜 싸게
- 자동 계산 후에도 판매가를 수동으로 미세 조정 가능
- "공시" 버튼 누르면 → 해당 업체가 로그인했을 때 새 단가표가 보임

---

### 4-2. 업체 전용 화면

- 단가표 (본인 업체 전용)
- 발주 신청 (장바구니 → 발주)
- 발주 내역 확인
- 재고 조회

### 4-3. 발주 관리 (관리자)

**발주 상태 흐름:**
```
발주접수 → 발주확인 → 출고대기 → 출고완료(배송중) → 배송완료
                 ↘ 보류 / 거절
```

### 4-4. 재고 관리

- 발주 "출고완료" 처리 → 재고 자동 차감
- 입고 등록 → 재고 자동 추가
- 재고 부족/긴급 알림

### 4-5. 매출/실적 대시보드

- 매출액, 매입원가, 매출이익, 이익률
- 장려금 현황
- 업체별 매출 순위
- 적자 판매 알림

---

## 5. 데이터베이스 설계

### 핵심 테이블

- **companies** - 업체(거래처) 정보 + 로그인
- **products** - 제품 마스터
- **samsung_prices** - 삼성 출고가 (매월 변동)
- **incentive_rates** - 장려금율 (월별)
- **company_incentive_ratios** - 업체별 장려금 반영 비율
- **published_prices** - 업체별 공시 단가
- **orders** - 발주
- **order_items** - 발주 상세
- **inventory** - 재고
- **inventory_logs** - 입출고 이력
- **sell_in_records** - 셀인(매입) 기록
- **sell_out_records** - 셀아웃(판매) 기록

---

## 6. 단가 자동 계산 공식

```
A = 출고가
B = DC율
C = 매입가 = A × (1 - B)

D1~D4 = 장려금율 (셀인, 셀아웃, 분기, 년)
E1~E4 = 업체별 반영비율

적용 장려금 합계 = D1×E1 + D2×E2 + D3×E3 + D4×E4
장려금 금액 = C × (적용 장려금 합계 / 100)

자동계산 판매가 = C - 장려금 금액 + 우리 마진
→ 수동 조정 가능 → "공시"로 업체에 노출
```

---

## 7. 기술 스택

| 구분 | 기술 |
|------|------|
| 프레임워크 | Next.js (App Router) |
| UI | shadcn/ui + Tailwind CSS |
| DB | Supabase (PostgreSQL) |
| 인증 | Supabase Auth |
| 엑셀 파싱 | SheetJS (xlsx) |
| 배포 | Vercel |

---

## 8. 페이지 구조

```
/ (로그인)
├─ /admin (관리자)
│   ├─ /dashboard        - 매출/실적
│   ├─ /pricing/samsung  - 삼성 출고가 업로드
│   ├─ /pricing/incentive - 장려금 설정
│   ├─ /pricing/publish  - 업체별 단가 산출/공시
│   ├─ /orders           - 발주 관리
│   ├─ /inventory        - 재고 현황
│   ├─ /companies        - 업체 관리
│   └─ /settings         - 시스템 설정
├─ /dealer (업체)
│   ├─ /prices           - 내 단가표
│   ├─ /order/new        - 발주 신청
│   ├─ /orders           - 내 발주 내역
│   └─ /inventory        - 재고 조회
└─ /api (백엔드)
```

---

## 9. MVP (최소 기능) 정의

1. 관리자가 업체별 최종 판매가를 입력할 수 있다
2. 업체가 로그인하면 본인 전용 단가표를 볼 수 있다
3. 업체가 제품을 선택하고 발주를 넣을 수 있다
4. 관리자가 발주 목록을 볼 수 있다

→ 이 4가지만 되면 당장 카톡 대신 웹앱을 쓸 수 있다.

---

## 10. 개발 순서

Phase 1: 기반 구축 → Phase 2: 단가 관리 → Phase 3: 발주 시스템 → Phase 4: 재고+매출 → Phase 5: 안정화
